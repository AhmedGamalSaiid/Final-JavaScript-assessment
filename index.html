<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>JavaScript Final Assessment</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#7c3aed;--muted:#94a3b8;--glass:rgba(255,255,255,0.03)}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:#e6eef8;background:linear-gradient(180deg,#071021 0%, #08131f 60%);}
    .wrap{max-width:980px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    header h1{font-size:20px;margin:0}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 30px rgba(2,6,23,0.6);}
    label{display:block;margin-bottom:6px;color:var(--muted);font-size:13px}
    input[type=text], input[type=email]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:#e6eef8}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{background:var(--accent);border:0;color:white;padding:10px 14px;border-radius:10px;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    .question{margin:14px 0;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
    .q-title{font-weight:600;margin-bottom:8px}
    .options{display:flex;flex-direction:column;gap:8px}
    .small{font-size:13px;color:var(--muted)}
    .results{margin-top:16px;padding:12px;border-radius:8px;background:#071226}
    .hidden{display:none}
    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
    @media (max-width:640px){.wrap{padding:12px}header h1{font-size:18px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="" alt="" style="width:48px;height:48px;border-radius:10px;background:linear-gradient(90deg,#7c3aed,#06b6d4);display:inline-block"> 
      <div>
        <h1>JavaScript — Final Assessment (Client-side)</h1>
        <div class="small">40–50 mixed questions covering Units 1–8. No backend. Results downloadable as CSV. Retake blocked via localStorage.</div>
      </div>
    </header>

    <div id="app" class="card">
      <div id="intro">
        <label for="studentName">Student Name (required)</label>
        <input id="studentName" type="text" placeholder="e.g. Ahmed Ali">
        <label for="studentId">Student ID (optional)</label>
        <input id="studentId" type="text" placeholder="e.g. 2025-001">
        <div class="actions">
          <button id="startBtn">Start Assessment</button>
          <button id="resumeBtn" class="ghost hidden">Resume Saved</button>
          <button id="clearBtn" class="ghost">Clear Local Data</button>
        </div>
        <p class="small" style="margin-top:10px">Note: This is a fully client-side assessment. To prevent re-taking, we set a flag in your browser's localStorage after submission. Clearing your browser storage or using another browser/device will allow a re-take.</p>
      </div>

      <div id="quiz" class="hidden">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="small">Student: <span id="displayName"></span> <span id="displayId"></span></div>
          <div class="small">Question <span id="qIndex">1</span> / <span id="qTotal">45</span></div>
        </div>

        <div id="questionContainer"></div>

        <div class="actions" style="margin-top:12px">
          <button id="prevBtn" class="ghost">Previous</button>
          <button id="nextBtn">Next</button>
          <button id="submitBtn">Submit</button>
        </div>
      </div>

      <div id="result" class="hidden">
        <h3>Results</h3>
        <div id="scoreBox" class="results"></div>
        <div style="margin-top:8px">
          <button id="downloadCSV">Download CSV</button>
          <button id="viewDetails" class="ghost">View Details</button>
        </div>
        <div id="details" class="hidden" style="margin-top:12px;max-height:360px;overflow:auto"></div>
      </div>

    </div>

    <footer>
      Ready to upload to GitHub Pages: commit this file as <code>index.html</code> to a repository and enable GitHub Pages (or host anywhere static).
    </footer>
  </div>

  <script>
    // ====== QUESTION BANK (45 questions spanning Units 1-8) ======
    const questions = [
      // Unit 1
      {id:'p1', unit:1, type:'mcq', q:"What is programming primarily about?", options:["Designing databases","Giving instructions to the computer","Painting graphics","Manufacturing hardware"], answer:[1]},
      {id:'p2', unit:1, type:'mcq', q:"Which of these is a programming language?", options:["HTML","CSS","JavaScript","Markdown"], answer:[2]},
      {id:'p3', unit:1, type:'fill', q:"Name a common IDE used for JavaScript development.", answer:["vscode","visual studio code","webstorm"]},
      {id:'p4', unit:1, type:'tf', q:"An interpreted language is always slower than a compiled language. (T/F)", answer:[false]},
      {id:'p5', unit:1, type:'mcq', q:"Which environment runs JavaScript on the server?", options:["Chrome","Node.js","Firefox","Edge"], answer:[1]},

      // Unit 2
      {id:'p7', unit:2, type:'mcq', q:"Which keyword declares a block-scoped variable?", options:["var","let","function","constant"], answer:[1]},
      {id:'p8', unit:2, type:'mcq', q:"Which declaration allows re-assignment but not re-declaration in the same scope?", options:["var","let","const","function"], answer:[1]},
      {id:'p9', unit:2, type:'fill', q:"Give an example of a valid JavaScript variable name (one word).", answer:["myVar","name","x","_value","a"]},
      {id:'p10', unit:2, type:'mcq', q:"Which of these is a primitive data type in JS?", options:["Object","Array","Number","Function"], answer:[2]},
      {id:'p11', unit:2, type:'mcq', q:"Which scope is accessible inside and outside a function?", options:["Local (inside function)","Global","Block","Module only"], answer:[1]},
      {id:'p12.1', unit:2, type:'tf', q:"Variables declared with var are hoisted. (T/F)", answer:[true]},
      {id:'p12.2', unit:2, type:'tf', q:"Variables declared with const are hoisted in the same way as var. (T/F)", answer:[false]},
      {id:'p13', unit:2, type:'mcq', q:"Which is true about const?", options:["Cannot be reassigned","Cannot be mutated","Not hoisted","Block scoped and cannot be reassigned"], answer:[3]},

      // Unit 3
      {id:'p14.1', unit:3, type:'mcq', q:"Which operator is used for strict equality (checks type)?", options:["=","==","===","!=="], answer:[2]},
      {id:'p14.2', unit:3, type:'mcq', q:"What does the % operator do?", options:["Exponent","Modulus (remainder)","Divide","Multiply"], answer:[1]},
      {id:'p15.1', unit:3, type:'mcq', q:"Which operator increases a numeric variable by one?", options:["--","++","+=","*="], answer:[1]},
      {id:'p15.2', unit:3, type:'mcq', q:"If x = 5; y = x++; what is y?", options:["4","5","6","undefined"], answer:[1]},
      {id:'p16', unit:3, type:'mcq', q:"Which is an assignment operator?", options:["==","===","=","=>"], answer:[2]},
      {id:'p17', unit:3, type:'mcq', q:"Which operator is logical AND?", options:["||","&&","!","??"], answer:[1]},

      // Unit 4
      {id:'p18', unit:4, type:'mcq', q:"Which statement is used to branch when condition is true?", options:["for","if","switch","while"], answer:[1]},
      {id:'p19', unit:4, type:'mcq', q:"Which structure checks multiple discrete values?", options:["if","switch","for","try-catch"], answer:[1]},
      {id:'p20', unit:4, type:'mcq', q:"Which loop is best when number of iterations is known?", options:["while","do-while","for","switch"], answer:[2]},
      {id:'p21', unit:4, type:'mcq', q:"Which loop executes at least once?", options:["for","while","do-while","forEach"], answer:[2]},
      {id:'p22', unit:4, type:'fill', q:"Name the method that shows a modal prompt and returns the user's text.", answer:["prompt"]},
      {id:'p23', unit:4, type:'mcq', q:"Which dialog returns true or false?", options:["alert","prompt","confirm","console.log"], answer:[2]},

      // Unit 5
      {id:'p25', unit:5, type:'mcq', q:"Which keyword defines a function?", options:["func","function","def","lambda"], answer:[1]},
      {id:'p26.1', unit:5, type:'mcq', q:"Recursion is when a function calls ...?", options:["another function","itself","only built-in functions","no functions"], answer:[1]},
      {id:'p26.2', unit:5, type:'tf', q:"Recursive functions must always have a base case. (T/F)", answer:[true]},
      {id:'p27', unit:5, type:'mcq', q:"Which is a built-in JS function?", options:["parseInt","myFunction","doStuff","customFn"], answer:[0]},

      // Unit 6
      {id:'p28.1', unit:6, type:'mcq', q:"Which method returns the length of a string?", options:["size","len","length","count"], answer:[2]},
      {id:'p29.1', unit:6, type:'mcq', q:"A regex literal in JS is enclosed with what?", options:["\\","/ /","[]","()"], answer:[1]},
      {id:'p30.1', unit:6, type:'mcq', q:"Which is a method to add an element to the end of an array?", options:["push","pop","shift","unshift"], answer:[0]},
      {id:'p30.2', unit:6, type:'mcq', q:"Which method creates a new array by transforming each element?", options:["filter","map","slice","splice"], answer:[1]},
      {id:'p30.3', unit:6, type:'tf', q:"JS has true associative arrays. (T/F)", answer:[false]},
      {id:'p31', unit:6, type:'fill', q:"What constructor creates a Date object? (one word)", answer:["date"]},
      {id:'p32', unit:6, type:'mcq', q:"Which keyword begins error handling?", options:["catch","throw","try","finally"], answer:[2]},
      {id:'p33.1', unit:6, type:'mcq', q:"Which is used to create an object with properties?", options:["[]","()","{}","<>"], answer:[2]},

      // Unit 7
      {id:'p35', unit:7, type:'mcq', q:"IIFE stands for...", options:["Immediately Invoked Function Expression","Internal Iteration For Every","Instance Instance Func Expr","None"], answer:[0]},
      {id:'p36.1', unit:7, type:'mcq', q:"Which method sets 'this' explicitly when calling a function?", options:["bind","call","apply","All of the above"], answer:[3]},

      // Unit 8
      {id:'p37', unit:8, type:'mcq', q:"BOM stands for...", options:["Browser Object Model","Binary Object Model","Browser Oriented Markup","Base Object Model"], answer:[0]},
      {id:'p38.1', unit:8, type:'mcq', q:"Which object references the browser window?", options:["document","window","navigator","screen"], answer:[1]},
      {id:'p40', unit:8, type:'mcq', q:"Which object gives access to browser history (back/forward)?", options:["history","window","location","navigator"], answer:[0]},
      {id:'p43', unit:8, type:'mcq', q:"Which method selects an element by CSS selector?", options:["getElementById","querySelector","getElementsByClassName","getElementsByTagName"], answer:[1]},
      {id:'p45', unit:8, type:'mcq', q:"Which method creates a new DOM element?", options:["createElement","newElement","makeElement","appendElement"], answer:[0]},
      {id:'p46', unit:8, type:'mcq', q:"CSS selector '.btn.primary' means:", options:["element named btn.primary","class 'btn' and class 'primary'","id 'btn' with class primary","nested selector"], answer:[1]},
      {id:'p47', unit:8, type:'mcq', q:"To change text inside an element you use:?", options:["innerText","innerHTML","textContent","All of the above"], answer:[3]},
      {id:'p52', unit:8, type:'mcq', q:"Which event fires when the user clicks?", options:["load","submit","click","change"], answer:[2]},
      {id:'p53', unit:8, type:'mcq', q:"Event object is usually received as which parameter?", options:["evt","event","e","All common"], answer:[3]},
      {id:'p55.1', unit:8, type:'mcq', q:"Which attribute identifies a form element's name?", options:["id","name","class","type"], answer:[1]},

      // Add a few multi-select questions and code-output or short-answer
      {id:'mult1', unit:3, type:'checkbox', q:"Select all truthy values:", options:["0","\"hello\"","[]","null","undefined"], answer:[1,2]},
      {id:'mult2', unit:6, type:'checkbox', q:"Select array methods that mutate the original array:", options:["map","push","splice","filter","pop"], answer:[1,2,4]},
      {id:'code1', unit:3, type:'fill', q:"What is the output of: console.log(typeof NaN); (type exactly)", answer:["number"]},
      {id:'code2', unit:5, type:'fill', q:"What will be printed?\nlet a = [1,2,3]; console.log(a.push(4));\n(enter the number printed)", answer:["4"]},
      {id:'short1', unit:2, type:'fill', q:"What keyword would you use to create a read-only reference to a value?", answer:["const"]},

      // A couple more to reach ~45
      {id:'u1extra', unit:1, type:'mcq', q:"Client-side JavaScript typically runs in which environment?", options:["Node.js","Browser","ServerFarm","Docker"], answer:[1]},
      {id:'u4extra', unit:4, type:'mcq', q:"Switch-case uses which keyword to exit a case?", options:["break","stop","exit","return"], answer:[0]},
      {id:'u6extra', unit:6, type:'tf', q:"Array.prototype.slice returns a new array without mutating. (T/F)", answer:[true]},
      {id:'u8extra', unit:8, type:'fill', q:"Which property returns an element's CSS classes as a DOMTokenList?", answer:["classlist","classList"]}
    ];

    // Ensure total count displayed
    const TOTAL = questions.length;
    document.getElementById('qTotal').textContent = TOTAL;

    // ====== APP STATE ======
    let state = {
      name: '', id: '', index: 0, answers: {}, completed:false
    };

    // ====== UTIL ======
    function el(id){return document.getElementById(id)}

    function loadSaved(){
      const saved = localStorage.getItem('finalQuiz_saved');
      if(saved){
        try{ const obj = JSON.parse(saved); return obj; }catch(e){return null}
      }
      return null;
    }

    function saveProgress(){
      const data = {name:state.name,id:state.id,index:state.index,answers:state.answers,ts:new Date().toISOString()};
      localStorage.setItem('finalQuiz_saved', JSON.stringify(data));
    }

    function clearLocal(){
      localStorage.removeItem('finalQuiz_saved');
      localStorage.removeItem('finalQuiz_completed');
      localStorage.removeItem('finalQuiz_result');
      alert('Local data cleared. You may restart the quiz.');
      location.reload();
    }

    // ====== RENDERING ======
    function renderQuestion(i){
      const q = questions[i];
      const container = el('questionContainer');
      container.innerHTML = '';
      const box = document.createElement('div'); box.className='question';
      const title = document.createElement('div'); title.className='q-title'; title.textContent = `Q${i+1}: ${q.q}`;
      box.appendChild(title);
      const meta = document.createElement('div'); meta.className='small'; meta.textContent = `Unit ${q.unit} — (${q.type})`;
      box.appendChild(meta);

      const opts = document.createElement('div'); opts.className='options';
      if(q.type === 'mcq'){
        q.options.forEach((op, idx)=>{
          const id = `q_${i}_${idx}`;
          const label = document.createElement('label');
          const input = document.createElement('input'); input.type='radio'; input.name=`q_${i}`; input.value=idx; input.id=id;
          if(state.answers[i] != null && state.answers[i][0] == idx) input.checked = true;
          label.appendChild(input); label.appendChild(document.createTextNode(' ' + op));
          opts.appendChild(label);
        });
      } else if(q.type === 'checkbox'){
        q.options.forEach((op, idx)=>{
          const id = `q_${i}_${idx}`;
          const label = document.createElement('label');
          const input = document.createElement('input'); input.type='checkbox'; input.name=`q_${i}`; input.value=idx; input.id=id;
          if(state.answers[i] && state.answers[i].includes(idx)) input.checked = true;
          label.appendChild(input); label.appendChild(document.createTextNode(' ' + op));
          opts.appendChild(label);
        });
      } else if(q.type === 'tf'){
        ['True','False'].forEach((t, idx)=>{
          const id = `q_${i}_tf_${idx}`;
          const label = document.createElement('label');
          const input = document.createElement('input'); input.type='radio'; input.name=`q_${i}`; input.value=(idx===0); input.id=id;
          if(state.answers[i] != null && ((state.answers[i][0]===true && idx===0) || (state.answers[i][0]===false && idx===1))) input.checked=true;
          label.appendChild(input); label.appendChild(document.createTextNode(' ' + t));
          opts.appendChild(label);
        });
      } else if(q.type === 'fill'){
        const input = document.createElement('input'); input.type='text'; input.style.width='100%'; input.value = (state.answers[i] ? state.answers[i][0] : '');
        opts.appendChild(input);
      }

      box.appendChild(opts);
      container.appendChild(box);
      el('qIndex').textContent = i+1;

      // attach change listeners
      container.querySelectorAll('input').forEach(inp=>{
        inp.addEventListener('change', ()=>{
          captureAnswer(i);
          saveProgress();
        });
      });

      if(q.type === 'fill'){
        opts.querySelector('input').addEventListener('blur', ()=>{ captureAnswer(i); saveProgress(); });
      }
    }

    function captureAnswer(i){
      const q = questions[i];
      if(q.type === 'mcq'){
        const sel = document.querySelector(`input[name=q_${i}]:checked`);
        if(sel) state.answers[i] = [parseInt(sel.value)];
      } else if(q.type === 'checkbox'){
        const sels = Array.from(document.querySelectorAll(`input[name=q_${i}]:checked`)).map(n=>parseInt(n.value));
        state.answers[i] = sels;
      } else if(q.type === 'tf'){
        const sel = document.querySelector(`input[name=q_${i}]:checked`);
        if(sel) state.answers[i] = [sel.value === 'true' || sel.value === true];
      } else if(q.type === 'fill'){
        const val = document.querySelector(`#questionContainer input[type=text]`).value.trim();
        state.answers[i] = [val];
      }
    }

    // ====== NAVIGATION ======
    el('startBtn').addEventListener('click', ()=>{
      const name = el('studentName').value.trim();
      if(!name){alert('Please enter your name.'); return}
      // check completed flag
      const completed = localStorage.getItem('finalQuiz_completed');
      if(completed){
        const obj = JSON.parse(localStorage.getItem('finalQuiz_result') || '{}');
        if(obj && obj.name && obj.name !== name){
          // warn: other name completed
        }
        if(confirm('This browser shows that the quiz was already completed. If you proceed, you will view the results but cannot re-take. Show results now?')){
          showResult(); return;
        } else { return; }
      }

      state.name = name; state.id = el('studentId').value.trim();
      el('displayName').textContent = state.name; el('displayId').textContent = state.id ? `(${state.id})` : '';
      // load saved
      const saved = loadSaved();
      if(saved && saved.name === state.name){
        // resume
        if(confirm('Found saved progress for this name. Resume?')){
          state = {...state, index: saved.index, answers: saved.answers};
        }
      }

      el('intro').classList.add('hidden');
      el('quiz').classList.remove('hidden');
      renderQuestion(state.index);
    });

    el('prevBtn').addEventListener('click', ()=>{
      if(state.index > 0) state.index--; renderQuestion(state.index); saveProgress();
    });
    el('nextBtn').addEventListener('click', ()=>{
      if(state.index < TOTAL-1) state.index++; renderQuestion(state.index); saveProgress();
    });

    el('submitBtn').addEventListener('click', ()=>{
      if(!confirm('Submit assessment? You will not be able to retake this assessment on this browser.')) return;
      // capture current
      captureAnswer(state.index);
      // grade
      const res = grade();
      // store completed
      localStorage.setItem('finalQuiz_completed', JSON.stringify({name:state.name,id:state.id,ts:new Date().toISOString()}));
      localStorage.setItem('finalQuiz_result', JSON.stringify(res));
      // clear saved progress
      localStorage.removeItem('finalQuiz_saved');
      state.completed = true;
      showResult(res);
    });

    el('clearBtn').addEventListener('click', ()=>{ if(confirm('Clear local storage for this quiz? This will allow retakes on this browser.')) clearLocal(); });

    el('downloadCSV').addEventListener('click', ()=>{
      const raw = JSON.parse(localStorage.getItem('finalQuiz_result') || '{}');
      if(!raw || !raw.name){ alert('No result found.'); return; }
      const rows = [];
      rows.push(['Name','StudentID','Score','MaxScore','Date']);
      rows.push([raw.name, raw.id||'', raw.score, raw.max, raw.ts]);
      rows.push([]);
      rows.push(['Question','Your Answer','Correct Answer','Correct?','Unit']);
      raw.details.forEach(d=>{
        rows.push([`Q${d.index+1}: ${d.q}`, d.your, d.correct, d.isCorrect, d.unit]);
      });
      const csv = rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `${raw.name.replace(/\s+/g,'_')}_quiz_results.csv`; a.click(); URL.revokeObjectURL(url);
    });

    el('viewDetails').addEventListener('click', ()=>{
      const raw = JSON.parse(localStorage.getItem('finalQuiz_result') || '{}');
      if(!raw) return; const det = raw.details;
      const cont = el('details'); cont.innerHTML = '';
      det.forEach(d=>{
        const div = document.createElement('div'); div.style.padding='8px'; div.style.borderBottom='1px dashed rgba(255,255,255,0.03)';
        div.innerHTML = `<strong>Q${d.index+1}:</strong> ${d.q} <br><em>Your:</em> ${d.your} <br><em>Correct:</em> ${d.correct} <br><em>Unit:</em> ${d.unit} <br><em>Correct?</em> ${d.isCorrect}`;
        cont.appendChild(div);
      });
      el('details').classList.toggle('hidden');
    });

    function grade(){
      const details = [];
      let score=0; let max=0;
      questions.forEach((q,i)=>{
        max++;
        const ans = state.answers[i];
        let correct=false; let yourText='(no answer)'; let correctText='';
        if(q.type==='mcq'){
          correctText = q.options[q.answer[0]];
          if(ans && ans.length>0){ yourText = q.options[ans[0]]; if(ans[0]===q.answer[0]) correct=true; }
        } else if(q.type==='checkbox'){
          correctText = q.options.filter((o,idx)=>q.answer.includes(idx)).join(' | ');
          if(ans){ yourText = ans.map(a=>q.options[a]).join(' | '); // check sets equal
            const want = q.answer.slice().sort().join(','); const got = ans.slice().sort().join(','); if(want===got) correct=true;
          }
        } else if(q.type==='tf'){
          correctText = q.answer[0] ? 'True' : 'False';
          if(ans && ans.length>0){ yourText = ans[0] ? 'True' : 'False'; if((ans[0]===true && q.answer[0]===true) || (ans[0]===false && q.answer[0]===false)) correct=true; }
        } else if(q.type==='fill'){
          correctText = Array.isArray(q.answer) ? q.answer.join(' | ') : String(q.answer);
          if(ans && ans.length>0){ yourText = ans[0]; // compare case-insensitive trimmed
            const normYour = String(yourText).trim().toLowerCase();
            const matches = q.answer.some(a=>String(a).trim().toLowerCase()===normYour);
            if(matches) correct=true;
          }
        }
        if(correct) score++;
        details.push({index:i,q:q.q,your:yourText,correct:correctText,isCorrect:correct,unit:q.unit});
      });
      const summary = {name:state.name,id:state.id,score, max, ts:new Date().toLocaleString(), details};
      return summary;
    }

    function showResult(res){
      const r = res || JSON.parse(localStorage.getItem('finalQuiz_result')||'null');
      if(!r){ alert('No result found.'); return; }
      el('quiz').classList.add('hidden'); el('result').classList.remove('hidden');
      el('scoreBox').innerHTML = `<strong>${r.name}</strong> — Score: <strong>${r.score}/${r.max}</strong> (${Math.round(r.score/r.max*100)}%)<br><div class='small'>Submitted: ${r.ts}</div>`;
      el('details').classList.add('hidden');
    }

    // On load: check saved progress or completed flag
    window.addEventListener('load', ()=>{
      const saved = loadSaved();
      if(saved){ el('resumeBtn').classList.remove('hidden'); el('resumeBtn').addEventListener('click', ()=>{
        el('studentName').value = saved.name; el('studentId').value = saved.id || ''; if(confirm('Start with the saved name?')) el('startBtn').click();
      });
      }

      const completed = localStorage.getItem('finalQuiz_completed');
      if(completed){
        const res = JSON.parse(localStorage.getItem('finalQuiz_result')||'null');
        if(res){
          // expose a quick result view
          const info = JSON.parse(completed);
          const note = document.createElement('div'); note.className='small'; note.style.marginTop='10px';
          note.innerHTML = `This browser already has a completed submission for <strong>${info.name}</strong> on ${info.ts || ''}. You can view the result after entering your name.`;
          document.getElementById('intro').appendChild(note);
        }
      }
    });

    // Save progress periodically
    setInterval(()=>{ if(!state.completed && state.name) saveProgress(); }, 30000);

  </script>
</body>
</html>
